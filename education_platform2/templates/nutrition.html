{% extends "base.html" %}

{% block title %}–†–µ—Ü–µ–ø—Ç—ã{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-4"><i class="bi bi-journal-text"></i> –†–µ—Ü–µ–ø—Ç—ã –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è</h1>
        </div>
        <div class="col-auto">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRecipeModal">
                <i class="bi bi-plus-lg"></i> –î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç
            </button>
        </div>
    </div>

    <!-- ========== –ì–ï–ù–ï–†–ê–¢–û–† –†–ï–¶–ï–ü–¢–û–í –ß–ï–†–ï–ó –ò–ò (–ù–û–í–û–ï) ========== -->
    <div class="card mb-4 shadow-sm bg-light">
        <div class="card-header bg-success text-white">
            <h4 class="mb-0"><i class="bi bi-robot"></i> –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–µ—Ü–µ–ø—Ç–æ–≤ (–ò–ò)</h4>
        </div>
        <div class="card-body">
            <form id="aiRecipeForm" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">–¢–∏–ø –±–ª—é–¥–∞</label>
                    <select class="form-select" name="dish_type">
                        <option value="">–õ—é–±–æ–µ</option>
                        <option value="–∑–∞–≤—Ç—Ä–∞–∫">–ó–∞–≤—Ç—Ä–∞–∫</option>
                        <option value="–æ–±–µ–¥">–û–±–µ–¥</option>
                        <option value="—É–∂–∏–Ω">–£–∂–∏–Ω</option>
                        <option value="–¥–µ—Å–µ—Ä—Ç">–î–µ—Å–µ—Ä—Ç</option>
                        <option value="–ø–µ—Ä–µ–∫—É—Å">–ü–µ—Ä–µ–∫—É—Å</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">–ö—É—Ö–Ω—è</label>
                    <input type="text" class="form-control" name="cuisine" placeholder="–∏—Ç–∞–ª—å—è–Ω—Å–∫–∞—è, –∞–∑–∏–∞—Ç—Å–∫–∞—è...">
                </div>
                <div class="col-md-3">
                    <label class="form-label">–î–∏–µ—Ç–∞</label>
                    <input type="text" class="form-control" name="dietary" placeholder="–≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ, –≤–µ–≥–∞–Ω—Å–∫–æ–µ...">
                </div>
                <div class="col-md-3">
                    <label class="form-label">–ú–∞–∫—Å. –∫–∞–ª–æ—Ä–∏–π</label>
                    <input type="number" class="form-control" name="max_calories" placeholder="500">
                </div>
                <div class="col-12">
                    <label class="form-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è</label>
                    <input type="text" class="form-control" name="notes" placeholder="–±–µ–∑ –æ—Ä–µ—Ö–æ–≤, –æ—Å—Ç—Ä–æ–µ, —Å –∫—É—Ä–∏—Ü–µ–π...">
                </div>
                <div class="col-12">
                    <button type="submit" id="generateRecipeBtn" class="btn btn-success">
                        <i class="bi bi-magic"></i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç
                    </button>
                    <span id="aiRecipeStatus" class="ms-3 text-muted"></span>
                </div>
            </form>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
            <div id="generatedRecipeResult" class="mt-4"></div>
        </div>
    </div>

    <!-- ========== –ì–ï–ù–ï–†–ê–¢–û–† –ü–õ–ê–ù–ê –ü–ò–¢–ê–ù–ò–Ø –ß–ï–†–ï–ó –ò–ò (–ù–û–í–û–ï) ========== -->
    <div class="card mb-4 shadow-sm bg-light">
        <div class="card-header bg-info text-white">
            <h4 class="mb-0"><i class="bi bi-robot"></i> –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å (–ò–ò)</h4>
        </div>
        <div class="card-body">
            <form id="aiMealplanForm" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">–¶–µ–ª–µ–≤—ã–µ –∫–∞–ª–æ—Ä–∏–∏</label>
                    <input type="number" class="form-control" name="calories_target" placeholder="2000">
                </div>
                <div class="col-md-3">
                    <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–µ–º–æ–≤</label>
                    <select class="form-select" name="meals_count">
                        <option value="3">3 –ø—Ä–∏–µ–º–∞ (–∑–∞–≤—Ç—Ä–∞–∫, –æ–±–µ–¥, —É–∂–∏–Ω)</option>
                        <option value="4">4 –ø—Ä–∏–µ–º–∞ (+ –ø–æ–ª–¥–Ω–∏–∫)</option>
                        <option value="5">5 –ø—Ä–∏–µ–º–æ–≤ (+ 2 —Å–Ω–µ–∫–∞)</option>
                        <option value="6">6 –ø—Ä–∏–µ–º–æ–≤ (–¥—Ä–æ–±–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ)</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">–í–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</label>
                    <input type="text" class="form-control" name="preferences" placeholder="–∫—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞, —Ä—ã–±–∞, –æ–≤–æ—â–∏...">
                </div>
                <div class="col-md-2">
                    <label class="form-label">–ò—Å–∫–ª—é—á–µ–Ω–∏—è</label>
                    <input type="text" class="form-control" name="restrictions" placeholder="–æ—Ä–µ—Ö–∏, –º–æ–ª–æ—á–Ω–æ–µ...">
                </div>
                <div class="col-12">
                    <button type="submit" id="generateMealplanBtn" class="btn btn-info text-white">
                        <i class="bi bi-magic"></i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω
                    </button>
                    <span id="aiMealplanStatus" class="ms-3 text-muted"></span>
                </div>
            </form>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è -->
            <div id="generatedMealplanResult" class="mt-4"></div>
        </div>
    </div>
    <!-- ========== –ö–û–ù–ï–¶ –ì–ï–ù–ï–†–ê–¢–û–†–ê –ü–õ–ê–ù–ê ========== -->
    <!-- ========== –ö–û–ù–ï–¶ –ì–ï–ù–ï–†–ê–¢–û–†–ê ========== -->

    <div class="row">
        {% for recipe in recipes %}
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                {% if recipe.image_url %}
                <img src="{{ recipe.image_url }}" class="card-img-top" alt="{{ recipe.title }}">
                {% endif %}
                <div class="card-body">
                    <h5 class="card-title">{{ recipe.title }}</h5>
                    <div class="nutrition-info mb-3">
                        <small class="text-muted">
                            <i class="bi bi-fire"></i> {{ recipe.calories }} –∫–∫–∞–ª
                            <span class="mx-2">|</span>
                            <i class="bi bi-egg"></i> –ë: {{ recipe.proteins }}–≥
                            <span class="mx-2">|</span>
                            <i class="bi bi-droplet"></i> –ñ: {{ recipe.fats }}–≥
                            <span class="mx-2">|</span>
                            <i class="bi bi-grid"></i> –£: {{ recipe.carbs }}–≥
                        </small>
                    </div>
                    <button class="btn btn-outline-primary btn-sm" onclick="viewRecipe({{ recipe.id }})">
                        <i class="bi bi-eye"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–∞ -->
<div class="modal fade" id="addRecipeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addRecipeForm">
                    <div class="mb-3">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞</label>
                        <input type="text" class="form-control" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</label>
                        <textarea class="form-control" name="ingredients" rows="4" required></textarea>
                        <small class="text-muted">–ö–∞–∂–¥—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</label>
                        <textarea class="form-control" name="instructions" rows="4" required></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label class="form-label">–ö–∞–ª–æ—Ä–∏–∏</label>
                            <input type="number" class="form-control" name="calories" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">–ë–µ–ª–∫–∏ (–≥)</label>
                            <input type="number" class="form-control" name="proteins" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">–ñ–∏—Ä—ã (–≥)</label>
                            <input type="number" class="form-control" name="fats" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</label>
                            <input type="number" class="form-control" name="carbs" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="url" class="form-control" name="image_url">
                    </div>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ—Ü–µ–ø—Ç–∞ -->
<div class="modal fade" id="viewRecipeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="recipeTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="recipeContent"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ========== –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
async function viewRecipe(recipeId) {
    try {
        const response = await fetch(`/nutrition/recipes/${recipeId}`);
        const recipe = await response.json();
        
        document.getElementById('recipeTitle').textContent = recipe.title;
        
        let content = `
            <div class="nutrition-info mb-4">
                <div class="row text-center">
                    <div class="col-md-3">
                        <h5><i class="bi bi-fire"></i> –ö–∞–ª–æ—Ä–∏–∏</h5>
                        <p>${recipe.calories} –∫–∫–∞–ª</p>
                    </div>
                    <div class="col-md-3">
                        <h5><i class="bi bi-egg"></i> –ë–µ–ª–∫–∏</h5>
                        <p>${recipe.proteins}–≥</p>
                    </div>
                    <div class="col-md-3">
                        <h5><i class="bi bi-droplet"></i> –ñ–∏—Ä—ã</h5>
                        <p>${recipe.fats}–≥</p>
                    </div>
                    <div class="col-md-3">
                        <h5><i class="bi bi-grid"></i> –£–≥–ª–µ–≤–æ–¥—ã</h5>
                        <p>${recipe.carbs}–≥</p>
                    </div>
                </div>
            </div>
            <h4>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</h4>
            <ul>
                ${recipe.ingredients.map(i => `<li>${i}</li>`).join('')}
            </ul>
            <h4>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h4>
            <p>${recipe.instructions}</p>
        `;
        
        document.getElementById('recipeContent').innerHTML = content;
        new bootstrap.Modal(document.getElementById('viewRecipeModal')).show();
    } catch (error) {
        console.error('Error:', error);
    }
}

document.getElementById('addRecipeForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = {
        title: formData.get('title'),
        ingredients: formData.get('ingredients').split('\n').filter(Boolean),
        instructions: formData.get('instructions'),
        calories: parseFloat(formData.get('calories')),
        proteins: parseFloat(formData.get('proteins')),
        fats: parseFloat(formData.get('fats')),
        carbs: parseFloat(formData.get('carbs')),
        image_url: formData.get('image_url')
    };
    
    try {
        const response = await fetch('/nutrition/recipes/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            location.reload();
        }
    } catch (error) {
        console.error('Error:', error);
    }
});

// ========== –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ì–ï–ù–ï–†–ê–¶–ò–Ø –†–ï–¶–ï–ü–¢–ê –ß–ï–†–ï–ó –ò–ò ==========
document.getElementById('aiRecipeForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    const payload = {
        dish_type: formData.get('dish_type') || '',
        cuisine: formData.get('cuisine') || '',
        dietary: formData.get('dietary') || '',
        max_calories: formData.get('max_calories') || '',
        notes: formData.get('notes') || ''
    };

    const status = document.getElementById('aiRecipeStatus');
    const btn = document.getElementById('generateRecipeBtn');
    const resultDiv = document.getElementById('generatedRecipeResult');

    status.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–∞...';
    btn.disabled = true;
    resultDiv.innerHTML = '';

    try {
        const res = await fetch('/api/generate-recipe', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (!res.ok) {
            throw new Error(`HTTP ${res.status}`);
        }

        const result = await res.json();
        
        if (!result.success) {
            status.textContent = '–û—à–∏–±–∫–∞: ' + (result.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è');
            btn.disabled = false;
            return;
        }

        status.textContent = '‚úÖ –†–µ—Ü–µ–ø—Ç –≥–æ—Ç–æ–≤!';
        
        const recipe = result.recipe;
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ—Ü–µ–ø—Ç
        const card = document.createElement('div');
        card.className = 'card border-success';
        card.innerHTML = `
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">${recipe.title}</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-3 text-center">
                        <small class="text-muted">–ö–∞–ª–æ—Ä–∏–∏</small>
                        <h6>${recipe.calories} –∫–∫–∞–ª</h6>
                    </div>
                    <div class="col-md-3 text-center">
                        <small class="text-muted">–ë–µ–ª–∫–∏</small>
                        <h6>${recipe.proteins}–≥</h6>
                    </div>
                    <div class="col-md-3 text-center">
                        <small class="text-muted">–ñ–∏—Ä—ã</small>
                        <h6>${recipe.fats}–≥</h6>
                    </div>
                    <div class="col-md-3 text-center">
                        <small class="text-muted">–£–≥–ª–µ–≤–æ–¥—ã</small>
                        <h6>${recipe.carbs}–≥</h6>
                    </div>
                </div>
                <h6>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</h6>
                <ul>
                    ${recipe.ingredients.map(i => `<li>${i}</li>`).join('')}
                </ul>
                <h6>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</h6>
                <p>${recipe.instructions}</p>
                <button class="btn btn-primary" onclick="saveGeneratedRecipe(${JSON.stringify(recipe).replace(/"/g, '&quot;')})">
                    <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É —Ä–µ—Ü–µ–ø—Ç–æ–≤
                </button>
            </div>
        `;
        
        resultDiv.appendChild(card);
        
    } catch (err) {
        console.error(err);
        status.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + err.message;
    } finally {
        btn.disabled = false;
    }
});

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞
async function saveGeneratedRecipe(recipe) {
    try {
        const response = await fetch('/nutrition/recipes/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(recipe)
        });
        
        if (response.ok) {
            alert('‚úÖ –†–µ—Ü–µ–ø—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
            location.reload();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
    }
}

// ========== –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–õ–ê–ù–ê –ü–ò–¢–ê–ù–ò–Ø –ß–ï–†–ï–ó –ò–ò ==========
document.getElementById('aiMealplanForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    const payload = {
        calories_target: formData.get('calories_target') || '',
        meals_count: formData.get('meals_count') || '3',
        preferences: formData.get('preferences') || '',
        restrictions: formData.get('restrictions') || ''
    };

    const status = document.getElementById('aiMealplanStatus');
    const btn = document.getElementById('generateMealplanBtn');
    const resultDiv = document.getElementById('generatedMealplanResult');

    status.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è...';
    btn.disabled = true;
    resultDiv.innerHTML = '';

    try {
        const res = await fetch('/api/generate-mealplan', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (!res.ok) {
            throw new Error(`HTTP ${res.status}`);
        }

        const result = await res.json();
        
        if (!result.success) {
            status.textContent = '–û—à–∏–±–∫–∞: ' + (result.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è');
            btn.disabled = false;
            return;
        }

        status.textContent = '‚úÖ –ü–ª–∞–Ω –≥–æ—Ç–æ–≤!';
        
        const meals = result.meals;
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è
        const card = document.createElement('div');
        card.className = 'card border-info';
        card.innerHTML = `
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üìã –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å</h5>
            </div>
            <div class="card-body">
                ${meals.map((meal, idx) => `
                    <div class="meal-card mb-3 p-3 border rounded" style="background-color: #f8f9fa;">
                        <h6 class="fw-bold text-primary">${idx + 1}. ${meal.meal_type}</h6>
                        <p class="mb-2"><strong>–ë–ª—é–¥–∞:</strong></p>
                        <ul class="mb-2">
                            ${meal.food_items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        <div class="row text-center small">
                            <div class="col-3">
                                <small class="text-muted">–ö–∞–ª–æ—Ä–∏–∏</small>
                                <br><strong>${meal.calories} –∫–∫–∞–ª</strong>
                            </div>
                            <div class="col-3">
                                <small class="text-muted">–ë–µ–ª–∫–∏</small>
                                <br><strong>${meal.proteins}–≥</strong>
                            </div>
                            <div class="col-3">
                                <small class="text-muted">–ñ–∏—Ä—ã</small>
                                <br><strong>${meal.fats}–≥</strong>
                            </div>
                            <div class="col-3">
                                <small class="text-muted">–£–≥–ª–µ–≤–æ–¥—ã</small>
                                <br><strong>${meal.carbs}–≥</strong>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
            <div class="card-footer text-muted text-center">
                <small>üí° –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ò–ò. –í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –±–ª—é–¥–∞ –≤ –¥–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è.</small>
            </div>
        `;
        
        resultDiv.appendChild(card);
        
    } catch (err) {
        console.error(err);
        status.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + err.message;
    } finally {
        btn.disabled = false;
    }
});
</script>{% endblock %}